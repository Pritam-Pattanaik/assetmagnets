"use strict";(()=>{var e={};e.id=447,e.ids=[447],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},55315:e=>{e.exports=require("path")},84151:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>j,patchFetch:()=>E,requestAsyncStorage:()=>w,routeModule:()=>v,serverHooks:()=>x,staticGenerationAsyncStorage:()=>b});var o={};t.r(o),t.d(o,{POST:()=>h});var a=t(49303),n=t(88716),s=t(60670),i=t(87070);let l=require("fs/promises");var c=t(55315),u=t.n(c),p=t(79843),d=t(72331);let f=require("fs");var m=t.n(f);async function g(e){try{m().existsSync(e)||(await (0,l.mkdir)(e,{recursive:!0}),console.log(`Created directory: ${e}`))}catch(r){throw console.error(`Error creating directory ${e}:`,r),Error("Failed to create upload directory")}}async function y(e){let r=await e.arrayBuffer(),t=Buffer.from(r),o=`${(0,p.Z)()}-${e.name}`,a=u().join(process.cwd(),"public","uploads","resumes"),n=u().join(a,o);try{return await g(a),await (0,l.writeFile)(n,t),`/uploads/resumes/${o}`}catch(e){throw console.error("Error saving file:",e),Error("Failed to save resume file")}}async function h(e){try{await d.Z.$connect()}catch(e){return console.error("Failed to connect to database:",e),i.NextResponse.json({error:"Database connection error"},{status:500})}try{let r;let t=await e.formData(),o=t.get("name"),a=t.get("email"),n=t.get("phone"),s=t.get("coverLetter"),l=t.get("jobId"),c=t.get("resume");if(!o||!a||!l||!c)return i.NextResponse.json({error:"Missing required fields"},{status:400});if(!l||"string"!=typeof l)return console.error("Invalid jobId format:",l),i.NextResponse.json({error:"Invalid job ID format"},{status:400});let u=await y(c),p=await d.Z.jobListing.findUnique({where:{id:l},select:{title:!0}});if(!p)return i.NextResponse.json({error:"Job listing not found"},{status:404});try{r=await d.Z.jobApplication.create({data:{name:o,email:a,phone:n||null,coverLetter:s||null,resumeUrl:u,position:p.title,jobListing:{connect:{id:l}},status:"RECEIVED"}}),console.log("Job application created successfully with ID:",r.id)}catch(e){throw console.error("Database error creating job application:",e),Error(`Database error: ${e instanceof Error?e.message:"Unknown database error"}`)}return console.log("Job application received:",{name:o,email:a,phone:n,jobId:l,resumeUrl:u,coverLetter:s?`${s.substring(0,50)}...`:null}),i.NextResponse.json({success:!0,message:"Application submitted successfully",application:r},{status:201})}catch(r){console.error("Error processing application:",r);let e="Failed to process application";return r instanceof Error&&(e=`${e}: ${r.message}`,console.error("Error stack:",r.stack),("PrismaClientKnownRequestError"===r.name||"PrismaClientValidationError"===r.name)&&console.error("Prisma error details:",JSON.stringify(r,null,2))),i.NextResponse.json({error:e},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/career/apply/route",pathname:"/api/career/apply",filename:"route",bundlePath:"app/api/career/apply/route"},resolvedPagePath:"C:\\Users\\Pritam\\Desktop\\assetmagnets\\app\\api\\career\\apply\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:w,staticGenerationAsyncStorage:b,serverHooks:x}=v,j="/api/career/apply/route";function E(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:b})}},72331:(e,r,t)=>{t.d(r,{Z:()=>a});var o=t(53524);let a=global.prisma||new o.PrismaClient},6649:(e,r,t)=>{t.d(r,{Z:()=>i});var o=t(84770),a=t.n(o);let n=new Uint8Array(256),s=n.length;function i(){return s>n.length-16&&(a().randomFillSync(n),s=0),n.slice(s,s+=16)}},16099:(e,r,t)=>{t.d(r,{Z:()=>n});var o=t(30900);let a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).substr(1));let n=function(e,r=0){let t=(a[e[r+0]]+a[e[r+1]]+a[e[r+2]]+a[e[r+3]]+"-"+a[e[r+4]]+a[e[r+5]]+"-"+a[e[r+6]]+a[e[r+7]]+"-"+a[e[r+8]]+a[e[r+9]]+"-"+a[e[r+10]]+a[e[r+11]]+a[e[r+12]]+a[e[r+13]]+a[e[r+14]]+a[e[r+15]]).toLowerCase();if(!(0,o.Z)(t))throw TypeError("Stringified UUID is invalid");return t}},79843:(e,r,t)=>{t.d(r,{Z:()=>n});var o=t(6649),a=t(16099);let n=function(e,r,t){let n=(e=e||{}).random||(e.rng||o.Z)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,r){t=t||0;for(let e=0;e<16;++e)r[t+e]=n[e];return r}return(0,a.Z)(n)}},30900:(e,r,t)=>{t.d(r,{Z:()=>a});let o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&o.test(e)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972],()=>t(84151));module.exports=o})();